/*!
sarine.viewer.threejs - v0.4.0 -  Thursday, May 21st, 2015, 11:39:23 AM 
 The source code, name, and look and feel of the software are Copyright Â© 2015 Sarine Technologies Ltd. All Rights Reserved. You may not duplicate, copy, reuse, sell or otherwise exploit any portion of the code, content or visual design elements without express written permission from Sarine Technologies Ltd. The terms and conditions of the sarine.com website (http://sarine.com/terms-and-conditions/) apply to the access and use of this software.
 */
(function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};a=function(a){function b(a){b.__super__.constructor.call(this,a),i=a.color,q=a.font,t=a.infoOnly,i=i||16777215,D=1,this.version=$(this.element).data("version")||"v1",this.viewersBaseUrl=stones[0].viewersBaseUrl}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return c(b,a),d=void 0,E=void 0,F=void 0,A=void 0,j=void 0,v=void 0,b.material=void 0,f=void 0,g=void 0,D=void 0,G=void 0,s=void 0,h=void 0,r=void 0,i=void 0,q=void 0,w=!1,x=!1,y=!1,t=!1,s=!1,p=void 0,b.prototype.getScene=function(){return E},b.prototype.getRenderer=function(){return A},b.prototype.convertElement=function(){return this.element.css({width:"100%",height:"100%","min-width":200,"min-height":200}),this.element},b.prototype.first_init=function(){var a,b;return b=this,a=$.Deferred(),u(this.viewersBaseUrl+"atomic/"+this.version+"/assets/three.bundle.js").then(function(){return k.apply(b),$.when($.get(b.src+"SRNSRX.srn"),$.getJSON(b.src+"Info.json")).then(function(c,d){var f;return s=d[0],f=c[0].replace(/\s/g,"^").match(/Mesh(.*?)}/)[0].replace(/[Mesh|{|}]/g,"").split("^").filter(function(a){return a.length>0}),n.apply(b,[{vertices:f.slice(1,+parseInt(f[0])+1||9e9).map(function(a){return a.replace(",","").split(";").slice(0,3)}),polygons:f.slice(parseInt(f[0])+2,+f.length+1||9e9).map(function(a){return a.replace(/(\d+;)/,"").replace(/(;;|;,)/,"").split(",")})}]),s=m.apply(b),t||e.apply(b),a.resolve(b)})}),a},b.prototype.full_init=function(){var a;return a=$.Deferred(),a.resolve(this),a},b.prototype.play=function(){},b.prototype.stop=function(){},u=function(a){var b,c,e,f;return c=function(){return d=GetTHREE(),b.resolve(f)},f=this,b=$.Deferred(),$("[src='"+a+"']")[0]?($("[src='"+a+"']").on("load",c),b):(e=$("<script>",{type:"text/javascript"}).appendTo("body").end()[0],e.onload=c,e.src=a,b)},B=function(a,b){return v.rotation.x+=b/100,v.rotation.z-=a/100},e=function(){var a,b,c,d,e,f;return a=A.domElement,d=function(a){var b,c;if(w)return a.preventDefault(),b=a.clientX-x,c=a.clientY-y,x=a.clientX,y=a.clientY,B(b,c)},e=function(a){return a.preventDefault(),w=!0,x=a.clientX,y=a.clientY},f=function(a){return a.preventDefault(),w=!1},c=function(a){return function(a){return 1===a.touches.length?(a.preventDefault(),x=a.touches[0].pageX,y=a.touches[0].pageY):void 0}}(this),b=function(a){return function(a){var b,c;return 1===a.touches.length?(a.preventDefault(),b=a.touches[0].pageX-x,c=a.touches[0].pageY-y,x=a.touches[0].pageX,y=a.touches[0].pageY,B(b,c)):void 0}}(this),A.domElement.addEventListener("touchstart",c,!1),document.getElementsByTagName("body")[0].addEventListener("touchend",f,!1),document.getElementsByTagName("body")[0].addEventListener("touchmove",b,!1),document.getElementsByTagName("body")[0].addEventListener("mousemove",d,!1),A.domElement.addEventListener("mousedown",e,!1),document.getElementsByTagName("body")[0].addEventListener("mouseup",f,!1)},z=function(){return v&&(p.rotation.x=v.rotation.x,p.rotation.z=v.rotation.z,p.updateMatrix()),t||requestAnimationFrame(z),A.clear(),A.render(E,f),v&&v.rotation&&parseInt(Math.abs(v.rotation.x)%(2*Math.PI)*10)===parseInt(5*Math.PI)?A.render(F,g):void 0},n=function(a){var b,c,e,f,g,h,i,j,k;for(c=function(a,b){return b.faces.push(new d.Face3(a[0],a[1],a[2])),3!==a.length&&(a.splice(1,1),c(a,b)),b.computeFaceNormals()},b=new d.Geometry,j=a.vertices,f=0,h=j.length;h>f;f++)e=j[f],b.vertices.push(new d.Vector3(e[0]*D,e[1]*D,e[2]*D));for(k=a.polygons,g=0,i=k.length;i>g;g++)e=k[g],c(e,b);return v=new d.Mesh(b,this.material),v.material.opacity=1,v.material.transparent=!1,v.geometry.center(),E.add(C(v)),p=new d.EdgesHelper(v.clone(),0),p.renderOrder=1,p.material.linewidth=2,E.add(C(p)),p.position.setZ(100),p.updateMatrix(),v},C=function(a){return a.rotation.x=Math.PI/2,a},k=function(){return E=new d.Scene,F=new d.Scene,f=new d.OrthographicCamera(-4800,4800,4800,-4800,-1e4,1e4),E.add(f),f.position.set(0,0,5e3),f.lookAt(E.position),A=new d.WebGLRenderer({alpha:!0,logarithmicDepthBuffer:!1}),A.autoClear=!1,h=this.element.height()>this.element.width()?this.element.width():this.element.height(),g=new d.OrthographicCamera(h/-2,h/2,h/2,h/-2,-1e4,1e4),F.add(g),A.setSize(h,h),this.element[0].appendChild(A.domElement),this.material=new d.MeshBasicMaterial({color:13421772}),z()},l=function(a){var b,c,e,h,i,j,k,l,m,n,p,q,r;return l=a.name,m=a.origin,k=a.length,i=a.hex,p=a.topToButtom,b=a.data,c=a.dir,e=a.far,r=p?"x":"y",m["set"+r.toUpperCase()](m[r]*e),m.set(m.x/(f.right/g.right),m.y/(f.right/g.right),m.z/(f.right/g.right)),n=o({text:b.toFixed(2)+" mm",position:m}),j=new d.Object3D,j.name="info",q=p?"y":"x",h=n.geometry.boundingBox.max[q]-n.geometry.boundingBox.min[q]+10,k=b/2*1e3/(f.right/g.right)-h/2,j.add(n),j.add(new d.ArrowHelper(c,m.clone()["set"+q.toUpperCase()](m[q]+h/2),k,i,5,5)),p?c.setY(-1*c.y):c.setX(-1*c.x),j.add(new d.ArrowHelper(c,m.clone()["set"+q.toUpperCase()](m[q]-h/2),k,i,5,5)),j},o=function(a){var b,c,e,g,h,i;return g=a.text,e=a.position,b=a.hex,c=new d.MeshBasicMaterial({color:a.hex||0}),h=new d.TextGeometry(a.text,{size:15,font:"gentilis",wieght:"bold"}),h.center(),i=new d.Mesh(h,c),i.lookAt(f.position),i.position.set(e.x,e.y,e.z),i},m=function(a){var b,c;return a=a||0,b=new d.Object3D,b.name="info",b.add(l({origin:new d.Vector3(0,v.geometry.boundingBox.max.z,0),hex:a,topToButtom:!1,data:s.Length.mm,dir:new d.Vector3(1,0,0),far:1.5})),b.add(l({origin:new d.Vector3(0,v.geometry.boundingBox.max.z,0),hex:a,topToButtom:!1,data:s["Table Size"].mm,dir:new d.Vector3(1,0,0),far:1.25})),c=v.geometry.boundingBox.max.z-1e3*s.Crown["height-mm"]/2,b.add(l({origin:new d.Vector3(v.geometry.boundingBox.max.x,c,0),hex:a,topToButtom:!0,data:s.Crown["height-mm"],dir:new d.Vector3(v.geometry.boundingBox.max.x,c+1,0),far:1.15})),c=v.geometry.boundingBox.min.z+1e3*s.Pavilion["height-mm"]/2,b.add(l({origin:new d.Vector3(v.geometry.boundingBox.max.x,c,0),hex:a,topToButtom:!0,data:s.Pavilion["height-mm"],dir:new d.Vector3(v.geometry.boundingBox.max.x,-1*c,0),far:1.15})),c=v.geometry.boundingBox.min.z+1e3*s["Total Depth"].mm/2,b.add(l({origin:new d.Vector3(v.geometry.boundingBox.min.x,c,0),hex:a,topToButtom:!0,data:s["Total Depth"].mm,dir:new d.Vector3(v.geometry.boundingBox.min.x,c+1,0),far:1.15})),F.add(b),void z()},b}(Viewer),this.Threejs=a}).call(this);